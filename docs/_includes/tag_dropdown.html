{%- comment -%}
Accessible, mobile-friendly dropdown showing tag groups + counts.
Uses Tailwind only. No external JS dependencies.
{%- endcomment -%}

<div class="relative">
    <button id="tmsTagMenuButton"
            class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700"
            aria-haspopup="true" aria-expanded="false">
        Topics
        <svg class="ml-2 h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.94a.75.75 0 111.08 1.04l-4.24 4.5a.75.75 0 01-1.08 0l-4.24-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
        </svg>
    </button>

    <div id="tmsTagMenuPanel"
         class="absolute right-0 mt-2 hidden max-h-[70vh] w-[320px] overflow-y-auto rounded-lg border bg-white p-3 shadow-lg ring-1 ring-black/5 md:w-[520px]">
        {% assign groups = site.data.tag_groups %}
        {% for g in groups %}
        <div class="mb-3">
            <div class="px-2 py-1 text-xs font-semibold uppercase tracking-wide text-gray-500">
                {{ g.group }}
            </div>
            <ul class="mt-1 grid grid-cols-1 gap-1 md:grid-cols-2">
                {% for label in g.items %}
                {% assign posts_for_tag = site.tags[label] | default: empty %}
                {% assign count = posts_for_tag | size %}
                {% assign slug = label | slugify %}
                <li>
                    <a href="{{ site.baseurl }}/tags-{{ slug }}/"
                       class="flex items-center justify-between rounded-md px-2 py-2 text-sm hover:bg-gray-100">
                        <span class="truncate text-gray-700">{{ label }}</span>
                        <span class="ml-3 inline-flex min-w-[1.75rem] items-center justify-center rounded-full bg-gray-200 px-2 text-xs text-gray-700">{{ count }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% unless forloop.last %}<hr class="my-2 border-gray-200">{% endunless %}
        {% endfor %}

        <div class="mt-2 text-right">
            <a href="{{ '/tags/' | relative_url }}" class="text-sm font-medium text-indigo-600 hover:underline">Browse all tags â†’</a>
        </div>
    </div>
</div>

<script>
    // Lightweight toggle for the dropdown; closes on outside click and ESC.
    (function () {
        const btn = document.getElementById('tmsTagMenuButton');
        const panel = document.getElementById('tmsTagMenuPanel');

        function open()  { panel.classList.remove('hidden'); btn.setAttribute('aria-expanded', 'true'); }
        function close() { panel.classList.add('hidden');  btn.setAttribute('aria-expanded', 'false'); }

        btn.addEventListener('click', function (e) {
            e.stopPropagation();
            if (panel.classList.contains('hidden')) open(); else close();
        });

        document.addEventListener('click', function (e) {
            if (!panel.contains(e.target) && e.target !== btn) close();
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') close();
        });
    })();
</script>